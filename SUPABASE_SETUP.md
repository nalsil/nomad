# Supabase ì„¤ì • ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” Nomad í”„ë¡œì íŠ¸ì—ì„œ Supabase ë°±ì—”ë“œë¥¼ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [Supabase í”„ë¡œì íŠ¸ ìƒì„±](#1-supabase-í”„ë¡œì íŠ¸-ìƒì„±)
2. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ì •](#2-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-ì„¤ì •)
3. [í™˜ê²½ ë³€ìˆ˜ ì„¤ì •](#3-í™˜ê²½-ë³€ìˆ˜-ì„¤ì •)
4. [ì´ˆê¸° ë°ì´í„° ì‚½ì…](#4-ì´ˆê¸°-ë°ì´í„°-ì‚½ì…)
5. [í™•ì¸ ë° í…ŒìŠ¤íŠ¸](#5-í™•ì¸-ë°-í…ŒìŠ¤íŠ¸)

---

## 1. Supabase í”„ë¡œì íŠ¸ ìƒì„±

### 1.1 Supabase ê³„ì • ìƒì„± ë° ë¡œê·¸ì¸

1. [Supabase](https://supabase.com) ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸
2. "Start your project" í´ë¦­
3. GitHub, Google ë“±ìœ¼ë¡œ ë¡œê·¸ì¸

### 1.2 ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±

1. Dashboardì—ì„œ "New Project" í´ë¦­
2. í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥:
   - **Name**: `nomad-app` (ì›í•˜ëŠ” ì´ë¦„)
   - **Database Password**: ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ìƒì„± (ë‚˜ì¤‘ì— í•„ìš”í•˜ì§€ ì•ŠìŒ)
   - **Region**: `Northeast Asia (Seoul)` ì„ íƒ (í•œêµ­ ì‚¬ìš©ìì—ê²Œ ìµœì )
   - **Pricing Plan**: Free tier ì„ íƒ

3. "Create new project" í´ë¦­
4. í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œê¹Œì§€ 1-2ë¶„ ëŒ€ê¸°

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ì •

### 2.1 SQL Editor ì ‘ê·¼

1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "SQL Editor" í´ë¦­
2. "New Query" ë²„íŠ¼ í´ë¦­

### 2.2 ìŠ¤í‚¤ë§ˆ ìƒì„±

`supabase/migrations/001_initial_schema.sql` íŒŒì¼ì˜ ì „ì²´ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ SQL Editorì— ë¶™ì—¬ë„£ê¸°

```sql
-- supabase/migrations/001_initial_schema.sql íŒŒì¼ ë‚´ìš© ì „ì²´ ë³µì‚¬
```

**ì‹¤í–‰**:
- í•˜ë‹¨ì˜ "Run" ë²„íŠ¼ í´ë¦­ (ë˜ëŠ” Ctrl/Cmd + Enter)
- ì„±ê³µ ë©”ì‹œì§€ í™•ì¸: "Success. No rows returned"

### 2.3 ìƒì„±ëœ í…Œì´ë¸” í™•ì¸

ì¢Œì¸¡ ë©”ë‰´ "Table Editor"ì—ì„œ ë‹¤ìŒ í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸:

- âœ… `profiles` - ì‚¬ìš©ì í”„ë¡œí•„
- âœ… `cities` - ë„ì‹œ ì •ë³´
- âœ… `reviews` - ë¦¬ë·°
- âœ… `review_reactions` - ë¦¬ë·° ë°˜ì‘ (ì¢‹ì•„ìš”/ì‹«ì–´ìš”)
- âœ… `city_rankings` - ë„ì‹œ ë­í‚¹
- âœ… `posts` - ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€

---

## 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### 3.1 API í‚¤ í™•ì¸

1. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "Project Settings" (í†±ë‹ˆë°”í€´ ì•„ì´ì½˜) í´ë¦­
2. "API" ì„¹ì…˜ ì„ íƒ
3. ë‹¤ìŒ ê°’ë“¤ì„ ë³µì‚¬:
   - **Project URL**: `https://your-project.supabase.co`
   - **anon public**: `eyJhbGc...` (ê¸´ ë¬¸ìì—´)
   - **service_role**: `eyJhbGc...` (ê¸´ ë¬¸ìì—´, ë…¸ì¶œ ê¸ˆì§€!)

### 3.2 .env.local íŒŒì¼ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env.local` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš© ì…ë ¥:

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
```

**âš ï¸ ì¤‘ìš”**:
- `NEXT_PUBLIC_SUPABASE_URL`ê³¼ `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY`ëŠ” ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë˜ì–´ë„ ì•ˆì „í•©ë‹ˆë‹¤
- `SUPABASE_SERVICE_ROLE_KEY`ëŠ” **ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”!** (ì´ë¯¸ .gitignoreì— í¬í•¨ë¨)

---

## 4. ì´ˆê¸° ë°ì´í„° ì‚½ì…

### 4.1 ìƒ˜í”Œ ë„ì‹œ ë°ì´í„° ì‚½ì…

SQL Editorì—ì„œ `supabase/seed.sql` íŒŒì¼ì˜ ë‚´ìš©ì„ ì‹¤í–‰:

```sql
-- supabase/seed.sql íŒŒì¼ ë‚´ìš© ì „ì²´ ë³µì‚¬
```

"Run" ë²„íŠ¼ í´ë¦­í•˜ì—¬ ì‹¤í–‰

### 4.2 ë°ì´í„° í™•ì¸

1. ì¢Œì¸¡ ë©”ë‰´ "Table Editor" í´ë¦­
2. `cities` í…Œì´ë¸” ì„ íƒ
3. 12ê°œì˜ ìƒ˜í”Œ ë„ì‹œ ë°ì´í„° í™•ì¸:
   - ì„œìš¸, ë¶€ì‚°, ì¹˜ì•™ë§ˆì´, ë°œë¦¬, ë°©ì½•, ë„ì¿„...

### 4.3 ë­í‚¹ ê³„ì‚°

SQL Editorì—ì„œ ë‹¤ìŒ ëª…ë ¹ ì‹¤í–‰:

```sql
SELECT public.calculate_city_rankings();
```

ì´ì œ `city_rankings` í…Œì´ë¸”ì— ê° ì¹´í…Œê³ ë¦¬ë³„ ìˆœìœ„ê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.

---

## 5. í™•ì¸ ë° í…ŒìŠ¤íŠ¸

### 5.1 RLS (Row Level Security) í™•ì¸

1. "Authentication" > "Policies" ë©”ë‰´ í™•ì¸
2. ëª¨ë“  í…Œì´ë¸”ì— RLS ì •ì±…ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. ì£¼ìš” ì •ì±…:
   - ì½ê¸°: ëª¨ë“  ì‚¬ìš©ì í—ˆìš©
   - ì“°ê¸°/ìˆ˜ì •/ì‚­ì œ: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ í—ˆìš©

### 5.2 Next.js ì•± ì‹¤í–‰

```bash
npm run dev
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3000` ì ‘ì†:

- âœ… ë„ì‹œ ë¦¬ìŠ¤íŠ¸ê°€ Supabase ë°ì´í„°ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- âœ… í†µê³„ ì„¹ì…˜ì´ ì‹¤ì œ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ëŠ”ì§€ í™•ì¸
- âœ… ë¦¬ë·° ì„¹ì…˜ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸ (ë¦¬ë·°ê°€ ìˆëŠ” ê²½ìš°)

### 5.3 íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸

1. `/register` í˜ì´ì§€ ì ‘ì†
2. ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ íšŒì›ê°€ì…
3. Supabase Dashboard > "Authentication" > "Users"ì—ì„œ ìƒˆ ì‚¬ìš©ì í™•ì¸
4. "Table Editor" > `profiles` í…Œì´ë¸”ì—ì„œ í”„ë¡œí•„ì´ ìë™ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: "relation does not exist" ì˜¤ë¥˜

**í•´ê²°ì±…**:
- SQL Editorì—ì„œ ìŠ¤í‚¤ë§ˆ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰
- ëª¨ë“  í…Œì´ë¸”ì´ `public` ìŠ¤í‚¤ë§ˆì— ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

### ë¬¸ì œ: ë°ì´í„°ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
1. `.env.local` íŒŒì¼ì˜ í™˜ê²½ ë³€ìˆ˜ê°€ ì •í™•í•œì§€ í™•ì¸
2. Next.js ê°œë°œ ì„œë²„ ì¬ì‹œì‘ (`npm run dev`)
3. ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

### ë¬¸ì œ: RLS ì •ì±… ì˜¤ë¥˜

**í•´ê²°ì±…**:
- Supabase Dashboard > "Authentication" > "Policies" í™•ì¸
- ìŠ¤í‚¤ë§ˆ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ì˜ RLS ì •ì±… ë¶€ë¶„ ì¬ì‹¤í–‰

### ë¬¸ì œ: íšŒì›ê°€ì… í›„ í”„ë¡œí•„ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
- SQL Editorì—ì„œ íŠ¸ë¦¬ê±° í™•ì¸:
  ```sql
  SELECT * FROM pg_trigger WHERE tgname = 'on_auth_user_created';
  ```
- íŠ¸ë¦¬ê±°ê°€ ì—†ìœ¼ë©´ ìŠ¤í‚¤ë§ˆ ìŠ¤í¬ë¦½íŠ¸ì˜ íŠ¸ë¦¬ê±° ë¶€ë¶„ ì¬ì‹¤í–‰

---

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Supabase ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs)
- [Supabase Auth ê°€ì´ë“œ](https://supabase.com/docs/guides/auth)
- [Supabase Database ê°€ì´ë“œ](https://supabase.com/docs/guides/database)
- [RLS (Row Level Security) ê°€ì´ë“œ](https://supabase.com/docs/guides/auth/row-level-security)

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

Supabase ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´:

1. âœ… ë¦¬ë·° ì‘ì„± ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
2. âœ… ë„ì‹œ ê²€ìƒ‰ ë° í•„í„°ë§ í…ŒìŠ¤íŠ¸
3. âœ… í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
4. ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„ (Vercel ë“±)

---

**ğŸ’¡ íŒ**: Supabase Dashboardì˜ "Logs" ì„¹ì…˜ì—ì„œ ì‹¤ì‹œê°„ ì¿¼ë¦¬ ë° ì—ëŸ¬ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
